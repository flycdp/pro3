<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="../less/Center_am.css">
    <script src="../pulg/bootstrap/js/jquery-3.4.0.js"></script>
    <style>
    </style>
</head>
<body>
<div class="Rec_box">
    <div class="Rec_mask"></div>
    <div class="Rec_con">
        <p class="Rec_p2"><span class="Rec_s2">×</span></p>
        <p>应付金额<span class="Rec_money">10</span>元</p>
        <img class="Rec_img" src="" alt="">
        <p>
            请打开<span></span><span class="Rec_payc"></span>“扫一扫”<br>
            完成支付
        </p>
    </div>
</div>
    <div id="header">
        <div class="div1">
            <a href=""><img src="../images/logo.png" alt="" class="img1"></a>
            <span class="s1"><b>YAY</b></span>
            <a href="" class="a2"><img src="../images/download_app.png" alt="" class="img2"></a>
        </div>
        <div class="div2">
            <ul>
                <li><a href=""><span>首页</span><span class="glyphicon glyphicon-chevron-down s3"></span></a></li>
                <li><a href=""><span>全部陪玩</span></a></li>
                <li><a href=""><span>聊天室</span></a></li>
                <li><a href=""><span>折扣专区</span></a></li>
                <li><a href=""><span>代练</span></a></li>
            </ul>
            <div class="div3">
                <input type="text" placeholder="请输入大神昵称" class="inp1">
                <div class="div4"><button class="btn1"><span class="glyphicon glyphicon-search s4"></span></button></div>
            </div>
            <div class="div5">
                <ul>
                    <li><a href=""><span>充值</span></a></li>
                    <li><a href=""><span>订单</span></a></li>
                    <li><a href=""><span>消息</span></a></li>
                </ul>
            </div>
        </div>
        <div class="div6">
            <a href="">
                <img src="../images/user.jpg" alt="">
                <span>XXXXXX</span>
            </a>

        </div>
    </div>
    <div id="contentbox">
        <div id="content">
            <div class="div8">
                <div class="div7">
                    <ul>
                        <li><a href=""><i><b class="b1"></b><b class="b2"></b></i><span class="s5">我的订单</span></a></li>
                        <li><a href=""><i><b class="b1 active-show"></b><b class="b2 active-show"></b></i><span class="s5 active-color">账号管理</span></a></li>
                        <li><a href=""><i><b class="b1"></b><b class="b2"></b></i><span class="s5">优惠券</span></a></li>
                        <li><a href=""><i><b class="b1"></b><b class="b2"></b></i><span class="s5">礼物记录</span></a></li>
                        <li><a href=""><i><b class="b1"></b><b class="b2"></b></i><span class="s5">我的资料</span></a></li>
                        <li><a href=""><i><b class="b1"></b><b class="b2"></b></i><span class="s5">安全设置</span></a></li>
                        <li><a href=""><i><b class="b1"></b><b class="b2"></b></i><span class="s5">会员中心</span></a></li>
                    </ul>
                </div>
            </div>
            <div class="div9">
                <div class="div10">
                    <ul>
                        <li class="js_am active1 "><a href="javascript:;" class="active1"><span>账号管理</span></a></li>
                        <li class="js_rec"><a href="javascript:;"><span>充值</span></a></li>
                    </ul>
                </div>
                <div class="div11">
                    <div class="am1 active">
                        <div class="div12"></div>
                        <div class="div14">
                            <p class="p5">交易明细</p>
                            <table cellspacing="0" cellpadding="0">
                                <thead>
                                    <tr>
                                        <th>订单号</th>
                                        <th>资金类型</th>
                                        <th>金额</th>
                                        <th>描述</th>
                                        <th>创建时间</th>
                                    </tr>
                                </thead>
                                <tbody>

                                </tbody>
                            </table>
                        </div>
                        <div class="div9-foot">
                            <div class="div15">
                                <ul>
                                    <li><span>←</span></li>
                                    <li><span>1</span></li>
                                    <li><span>→</span></li>
                                    <li class="l2"><p class="p4">10条/页</p></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="Rec">
                        <div class="div16">
                            <a href=""><img src="../images/am_Rec.jpg" alt=""></a>
                        </div>
                        <p style="margin-bottom: 10px">充值金额:</p>
                        <div class="div17">
                            <div class="div19">
                                <div class="div18">
                                    <div class="num active2">￥<span>10</span></div>
                                    <div class="give-fee active3">送<span>0</span></div>
                                </div>
                                <div class="div18">
                                    <div class="num">￥<span>50</span></div>
                                    <div class="give-fee">送<span>2.5</span></div>
                                </div>
                                <div class="div18">
                                    <div class="num">￥<span>100</span></div>
                                    <div class="give-fee">送<span>5</span></div>
                                </div>
                                <div class="div18">
                                    <div class="num">￥<span>200</span></div>
                                    <div class="give-fee">送<span>10</span></div>
                                </div>
                                <div class="div18">
                                    <div class="num">￥<span>500</span></div>
                                    <div class="give-fee">送<span>25</span></div>
                                </div>
                                <div class="div18">
                                    <div class="num">￥<span>1000</span></div>
                                    <div class="give-fee">送<span>50</span></div>
                                </div>
                                <input type="number" min="1" max="100000" placeholder="输入任意金额（不参与）">
                            </div>
                        </div>
                        <p style="margin-bottom: 10px">支付方式:</p>
                        <div class="pame">
                            <div class="weix active4"><div class="ritop"></div><span></span><span>微信</span></div>
                            <div class="zhifubao"><div></div><span></span><span>支付宝</span></div>
                        </div>
                        <p class="Rec_xuzi"><input type="checkbox"><a href="javascript:;">我已阅读并同意<span>《充值须知》</span></a></p>
                        <div class="Rec_foot">
                            <button class="">充 值</button>
                            <p>需支付<span>10</span></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

</body>
<script>
    var am={
        data:[
            {user_id:'01',user_bal:'500',user_inc:'0',user_tran_id:'01',user_tran_num:'DC00011010',user_tran_type:'支出',user_tran_money:'+50',user_tran_col:'col-red',user_tran_des:'订单退回',user_tran_date:'2019-06-14 15:01:11'},
            {user_id:'01',user_bal:'500',user_inc:'0',user_tran_id:'01',user_tran_num:'DC00011010',user_tran_type:'支出',user_tran_money:'-50',user_tran_col:'col-skyblue',user_tran_des:'订单退回',user_tran_date:'2019-06-14 15:01:11'},
            {user_id:'01',user_bal:'500',user_inc:'0',user_tran_id:'01',user_tran_num:'DC00011010',user_tran_type:'支出',user_tran_money:'+50',user_tran_col:'col-red',user_tran_des:'订单退回',user_tran_date:'2019-06-14 15:01:11'},

        ],
    };
    var user={
        data:{
            user_id:'01',user_bal:'500',user_inc:'0'
        }
    };

    //插入收入和余额
    function userBal() {
        $.ajax({
            url:'/userBal',
            type:'post',
            data:{
                user_id:1
            },
            success:function (res) {
                if (res.error){
                    console.log('数据库出错')
                }else {
                    $('.div12').html(' ');
                    var oDiv=document.createElement('div')
                    $(oDiv).html(`
                            <div class="div13">
                                <span></span>
                                <span>我的余额</span>
                                <span><strong>${res.data[0].userBalm}</strong><b>Y</b></span>
                            </div>
                            <div class="div13">
                                <span></span>
                                <span>我的收入</span>
                                <span><strong>${res.data[0].userIncm}</strong><b>Y</b></span>
                            </div>
                            <div class="div13">
                                <button class="btn2">转入余额</button>
                                <button class="btn3">充值</button>
                            </div>
                    `);
                    $('.div12').html(oDiv)
                }
            }
        });

    };
    userBal();

    //交易信息
    function tran(){
        $.ajax({
            url:'/tranDet',
            type:'post',
            data:{
                user_id:1
            },
            success:function (res) {
                if(res.error){
                    console.log('数据库出错')
                }else {
                    $('tbody').html(' ')
                    var arr=res.data;
                    $.each(arr,function (i,v) {
                        var money;
                        var oDate;
                        if (arr[i].rechargeNum){
                            money=arr[i].rechargeNum
                            oDate=arr[i].rechargeDate;
                        };
                        if(arr[i].yhjPre){
                            money=(arr[i].price)*arr[i].yhjPre
                            oDate=arr[i].date
                        };
                        if(arr[i].giftId){
                            money=arr[i].price
                            oDate=arr[i].sendTime
                        }
                        var oTr=document.createElement('tr')
                        $(oTr).html(`
                            <td class="td1">${v.code}</td>
                            <td>${v.moneyClass}</td>
                            <td class="col-write"></td>
                            <td>${v.moneyDes}</td>
                            <td>${oDate}</td>`)
                        if($(oTr).children().eq(1).html()=="进账"){
                            $(oTr).children().eq(2).addClass('col-red')
                            $(oTr).children().eq(2).html(`+${money}`)
                        }else {
                            $(oTr).children().eq(2).addClass('col-skyblue')
                            $(oTr).children().eq(2).html(`-${money}`)
                        }
                        $('tbody').append(oTr)

                    });
                    var iNow=arr.length;
                    var oH=iNow*62;
                    if (oH>300) {
                        var oH2=oH+120;
                        var oHC=oH+400;
                        $('.div11 .am1 .div14').css("height",oH2);
                        $('#content').css("height",oHC)
                    }
                }
            }
        });
    };
    tran();

    $('.div10').on('click','.js_am',function () {
        userBal();
        tran();
    });
    $('.div11').on('click','.btn3',function () {
        $('.js_am').removeClass('active1');
        $('.js_am a').removeClass('active1');
        $('.am1').removeClass('active');
        $('.js_rec').addClass('active1');
        $('.js_rec a').addClass('active1');
        $('.Rec').addClass('active');
    });
    //扫描二维码
    $('.Rec_box').on('click','.Rec_img',function () {
        var money=($('.Rec_money').html())/1+($('.active3>span').html())/1;
        var des=$('.Rec_payc').html()
        $.ajax({
            url:'/recMoney',
            type:'post',
            data:{
                user_id:1,
                money:money,
                moneydes:des
            },
            success:function (res) {
                if(res.error){
                    alert('充值失败')
                }else {
                    alert('充值成功')
                    $('.Rec_box').css('display','none')
                }

            }
        })
    })


    $('.div10').on('click','.js_rec',function () {
        $('#content').css('height','980')
    });
    $('.div10 li').click(function () {
        $('.div10 li').removeClass('active1');
        $('.div10 li a').removeClass('active1');
        $('.div11>div').removeClass('active');

        $(this).addClass('active1');
        $('.div11>div').eq($(this).index()).addClass('active');
        $('.div10 li a').eq($(this).index()).addClass('active1');
    });

    //充值方式
    $('.pame>div').click(function () {
        $('.pame div').removeClass('active4');
        $('.pame>div div').removeClass('ritop')
        $(this).addClass('active4');
        /*$('.pame>div div').eq($(this).index()).addClass('ritop');*/
        $(this).children().eq(0).addClass('ritop')
    });

    //充值须知
    $('.Rec_xuzi input').click(function () {
        if ($(this.checked).length) {
           $('.Rec .Rec_foot button').addClass('btn4')
        }else {
            $('.Rec .Rec_foot button').removeClass('btn4')
        }
    });

    //点击充值
    $('.Rec_foot').on('click','.btn4',function () {
        $('.Rec_money').html(' ')
        $('.Rec_box').css('display','block');
        var oMun=$('.Rec_foot span').html();
        $('.Rec_money').html(oMun);
        var oStr=$('.active4').children().eq(2).html();
        $('.Rec_payc').html(oStr);
        if (oStr=='微信'){
            $('.Rec_img').attr('src','../images/pay_img1.png');
        }else {
            $('.Rec_img').attr('src','../images/pay_img2.png');
        }
    });
    $('.Rec_s2').click(function () {
        $('.Rec_box').css('display','none')
    });

    $('.div18').click(function () {
        $('.div18 .num').removeClass('active2');
        $('.div18 .give-fee').removeClass('active3');
        $('.div18 .num').eq($(this).index()).addClass('active2');
        $('.div18 .give-fee').eq($(this).index()).addClass('active3');
        var num=$(this).children().children().html();
        $('.Rec_foot span').html(num)

    })
    $('.div19 input').on("input",function () {
        var num=$(this).val()
        if (num>100000){
            alert('你输入的金额过大，一次充值最多为10万元')
            return
        } else if(num<0){
            alert('金额不能为负')
            return
        }
        $('.Rec_foot span').html(num)
    });
    $('.div7 a').click(function () {
        $('.div7 b').removeClass('active-show');
        $('.div7 .s5').removeClass('active-color');
        $(this).children(0).children(0).addClass('active-show');
        $(this).children(1).addClass('active-color');
    });
    $('.div7 a').mouseover(function () {
        $('.div7 b').removeClass('active-show1');
        $('.div7 .s5').removeClass('active-color1');
        $(this).children(0).children(0).addClass('active-show1');
        $(this).children(1).addClass('active-color1');
    });
    $('.div7 a').mouseleave(function () {
        $('.div7 b').removeClass('active-show1');
        $('.div7 .s5').removeClass('active-color1');
    });
</script>
</html>